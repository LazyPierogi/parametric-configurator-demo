# Curtain Wizard default envs

# Default color palette for the application (signature | havinic)
NEXT_PUBLIC_DEFAULT_PALETTE=signature

# AI #1 (Measurement)
# Client-only toggle for measurement engine (vlm | localcv | auto)
NEXT_PUBLIC_MEASURE_ENGINE_DEBUG=vlm
# Providers: qwen (prod-default) | googleai | openai | localcv | noreref (experimental)
AI1_PROVIDER=qwen
AI1_GEMINI_MODEL=models/gemini-2.0-flash-lite
AI1_GPT_MODEL=openai/gpt-4o-mini
AI1_QWEN_MODEL=qwen3-vl-flash
# Provider keys (set at least one depending on provider)
OPENAI_API_KEY=your-key-here
GOOGLE_GENAI_API_KEY=your-key-here
# Qwen (Alibaba Cloud) - recommended for best accuracy-to-cost ratio
QWEN_API_KEY=your-key-here
QWEN_BASE_URL=https://dashscope-intl.aliyuncs.com/compatible-mode/v1

# AI #2 (Segmentation)
LOCAL_SEG_URL=http://127.0.0.1:8000/segment
# HF token for fallbacks (Mask2Former/SegFormer via Inference API)
HF_TOKEN=your-token-here

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Max image size for VLM measurement (long side in pixels). Default: 1536
MEASURE_LONG_SIDE=1536

# HEIC Conversion Optimization (Task HEIC-OPT)
# Maximum dimension (px) for converted HEIC images. Default: 2048
# Lower = smaller files & faster uploads, but may affect quality
HEIC_MAX_DIMENSION=768
# JPEG quality (0-100) for converted HEIC images. Default: 82
# Lower = smaller files & faster uploads, but may affect quality
HEIC_JPEG_QUALITY=80
# Client-side HEIC settings (must use NEXT_PUBLIC_ prefix for browser access)
NEXT_PUBLIC_HEIC_MAX_DIMENSION=768
NEXT_PUBLIC_HEIC_JPEG_QUALITY=80

# HEIC uploads convert to JPEG automatically (client + /api/convert-heic heic-convert fallback). No env toggle required.
# Auto-retry count for flow analysis (measurement + segmentation)
NEXT_PUBLIC_FLOW_AUTO_RETRIES=1
# Curtain box height source: auto (mask with ratio guard) | mask (force mask-based wall fraction when available) | full (ignore mask, use full-frame bbox)
NEXT_PUBLIC_CURTAIN_BOX_HEIGHT_SOURCE=auto

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Magento OAuth 1.0a credentials for order screenshot uploads
MAGENTO_OAUTH_CONSUMER_KEY=your_consumer_key
MAGENTO_OAUTH_CONSUMER_SECRET=your_consumer_secret
MAGENTO_OAUTH_ACCESS_TOKEN=your_access_token
MAGENTO_OAUTH_ACCESS_TOKEN_SECRET=your_access_token_secret
# Magento REST endpoint for screenshot uploads (optional)
# Example: https://example-magento.com/rest/V1/order_screenshot/create
MAGENTO_ORDER_SCREENSHOT_URL=

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Debug UI
NEXT_PUBLIC_CONFIGURE_DEBUG_UI=1
# Enables Debug drawer controls including the Weave Blend Mode selector (Multiply/Overlay) for artist textures.
# Stitch line overlay (Task 865b)
NEXT_PUBLIC_STITCH_LINES_ENABLED=0

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


# Canvas Rendering System (Task 1010+)
# Controls curtain preview rendering pipeline in Configure page
# artist  = Canvas rendering with artist-authored textures (PRODUCTION DEFAULT)
# off     = Legacy CSS textures (emergency fallback, no code deployment needed)
# 
# Artist pipeline uses pre-rendered 4-map textures (pleat ramp, weave, occlusion, translucency)
# with material-aware color blending for photorealistic curtain rendering.
# See: apps/web/lib/canvas-renderer/README.md
NEXT_PUBLIC_TEXTURES_PIPELINE=artist

# Base URL for artist-authored pleat textures (wave, flex, etc.)
# Production: set to your CDN/media server
# Local dev: can use same as production or local files
NEXT_PUBLIC_ARTIST_TEXTURES_BASE_URL=/media/textures/canvas

# Base URL for canvas textures (pleat maps, material weaves)
# Production: /texture_img (nginx static files)
# Local dev: / (serves from /public via Next.js routes)
NEXT_PUBLIC_CANVAS_TEXTURES_BASE_URL=/

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Using last cached photo if opening /configure directly
NEXT_PUBLIC_CONFIGURE_FALLBACK_LATEST=0

# AI#1 Upload limit
MAX_IMAGE_MB=15
# Expose MAX_IMAGE_MB to client (for pre-checks on uploads)
NEXT_PUBLIC_MAX_IMAGE_MB=15

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Optional local CV measurement service
LOCAL_MEASURE_URL=http://127.0.0.1:8000/measure
MEASURE_DEBUG=1
MEASURE_CAMERA_HEIGHT_CM=150
MEASURE_DEFAULT_FOV_DEG=74

MEASURE_RECTIFY_ENABLED=0
MEASURE_RECTIFY_TRIM_LOWER=2
MEASURE_RECTIFY_TRIM_UPPER=98
M2F_LONG_SIDE=768

# Clamp wall mask between ceiling/floor bands (1=on, 0=off)
MEASURE_WALL_CLAMP_ENABLED=1
# Fraction (0.0-0.2) of image height kept as padding inside the clamp bands
MEASURE_WALL_CLAMP_MARGIN_PCT=0.0075

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Material Reuse Optimization (Task 902+)
# When enabled, optimizes bolt count by reusing leftover material across segments
# Example: 2x50cm segments = 1 bolt instead of 2 (when capacity allows)
NEXT_PUBLIC_MATERIAL_REUSE_ENABLED=1

# Configurator Section Visibility (Task 904)
# Comma-separated list of sections to show in configurator panel
# Leave empty or unset to use defaults (budgetPerMeter is hidden by default)
# Available sections: fabricType,fabrics,color,style,colorCategory,pleating,hem,services,budgetPerMeter
# Example: fabricType,fabrics,pleating,hem,services
NEXT_PUBLIC_CONFIGURATOR_SECTIONS=fabricType,style,colorCategory,fabrics,pleating,hem,services

# Full technical view for Summary field in COnfigurator
NEXT_PUBLIC_SUMMARY_FIELDS="fabric,color,pleat,hem,services,dimensions,height,cutDrop,fabricOrdered,boltWidths,fullness,shrinkage,allowances,stitchLines,breakdown,constraints"

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Base URL for catalog assets (thumbnails, textures, tech diagrams). 
#`NEXT_PUBLIC_CATALOG_ASSET_BASE_URL` — client-visible override. For local assets set it to `/` so both server and browser resolve to local files.
NEXT_PUBLIC_CATALOG_ASSET_BASE_URL=/
# Server-side base URL for catalog textures, swatches, thumbs, and tech diagrams.
# Leave empty to serve from local Next.js `public/` (recommended for the open-source demo).
CATALOG_ASSET_BASE_URL=

# Catalog provider (mock|storefront). Use mock locally until Magento integration ships.
CATALOG_PROVIDER=mock

# Storefront integration (configure when CATALOG_PROVIDER=storefront)
# Magento GraphQL API endpoint (required for storefront provider)
NEXT_PUBLIC_GRAPHQL_ENDPOINT=
# Back-compat alias (some older scripts/configs use this name)
NEXT_PUBLIC_MAGENTO_GRAPHQL_URL=
# Legacy Magento direct integration (deprecated in favor of parent bridge)
STOREFRONT_MAGENTO_URL=
STOREFRONT_MAGENTO_TOKEN=
STOREFRONT_MAGENTO_CART_ID=
NEXT_PUBLIC_STOREFRONT_CART_URL=
# Parent-child iframe communication (Task 950) — DEPRECATED with direct Magento queries
# Origin of the parent storefront window (must match for security)
# Tip: can be a comma-separated allowlist (or use NEXT_PUBLIC_STOREFRONT_TRUSTED_ORIGINS)
NEXT_PUBLIC_STOREFRONT_ORIGIN=https://example-store.com
# Optional explicit allowlist for postMessage origins (comma-separated)
NEXT_PUBLIC_STOREFRONT_TRUSTED_ORIGINS=
# Timeout for parent window responses (milliseconds)
NEXT_PUBLIC_STOREFRONT_TIMEOUT_MS=30000

# Pricing Multipliers (for testing/adjustment)
# Multiply final Fabric and Labor prices shown in Summary panel
# Default: 1.0 (no change)
NEXT_PUBLIC_PRICE_FABRIC_MULTIPLIER=1.0
NEXT_PUBLIC_PRICE_LABOR_MULTIPLIER=1.0

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


# Lighting (Task 881 — client-safe)
# Global on/off for lighting (1=enabled, 0=disabled)
NEXT_PUBLIC_LIGHTING_ENABLED=1
# Lighting mode: off | lite | enhanced
NEXT_PUBLIC_LIGHTING_MODE=enhanced
# Overall strength (0.0 – 1.0)
NEXT_PUBLIC_LIGHTING_OPACITY=0.4
# Coarse sampling grid for whole-photo estimator
NEXT_PUBLIC_LIGHTING_GRID_X=48
NEXT_PUBLIC_LIGHTING_GRID_Y=32
# Throttle (ms) for any UI-updated recomputes (kept conservative)
NEXT_PUBLIC_LIGHTING_THROTTLE_MS=120

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Post-process defaults
# SEG_LONG_SIDE resizes images before HF fallbacks (min 64). Local Mask2Former path ignores it; use LOCAL_SEG_LONG_SIDE / X-Scale-Long-Side instead.
SEG_LONG_SIDE=768
# HF fallback safety guards; only used when local Mask2Former fails so HF never sees huge HEIC/JPEG uploads.
SEG_FALLBACK_LONG_SIDE=768
SEG_FALLBACK_JPEG_QUALITY=80
SEG_FALLBACK_MAX_BYTES=800000
##HF Inference only
SEG_WALL_MERGE_RADIUS=25

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

##local inference
LOCAL_SEG_LONG_SIDE=768
SEG_DEBUG=1
SEG_FILL_HOLES=1
SEG_HOLES_MAX_AREA_PCT=0.01
SEG_HOLES_BRIDGE_RADIUS=2
SEG_HOLES_BRIDGE_CAP=8
SEG_ATTACH_CONTACT_PCT=0.01
SEG_CONTACT_ANISO=0
SEG_SMOOTH=0
SEG_BYPASS_SUPPORT=0
SEG_M2F_COMPOSE_FROM_RAW=1
