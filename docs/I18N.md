# Internationalization (i18n)

This document explains how translations work in Curtain Wizard, how to add new copy, and how to introduce a new locale.

## Overview
- Shared message catalog lives in `packages/core/src/i18n/messages.ts`.
- Supported locales are defined in `packages/core/src/i18n/types.ts` (`supportedLocales`).
- The web app uses a lightweight runtime context (`apps/web/app/providers/locale-context.tsx`) to:
  - Resolve strings with `t(key, vars?)`.
  - Persist preference in `localStorage` and the URL as `?lang=xx`.
  - Lazy-load flattened bundles via `/api/i18n/[locale]`.

## Key conventions
- Use dotted namespaces and keep them close to the feature path.
  - Examples: `configure.panel.services`, `configure.summary.title`, `configure.progress.processing`.
- Prefer descriptive names; keep placeholders explicit: `{region}`, `{time}`, `{count}`.
- Reuse shared/common namespaces when possible (e.g., `common.yes`).

## Adding new copy
1. Edit `packages/core/src/i18n/messages.ts`.
2. Add your key under the most relevant namespace across all locales (`en`, `pl`, `uk`).
3. Use placeholders `{name}` and pass values via `t(key, { name: ... })`.
4. Avoid hard-coding tokens, secrets, or URLs in strings (keep them in env/config).
5. Run tests: `npm run test:catalog` (includes i18n consistency checks).

## Using translations in UI
```tsx
import { useLocale } from '@/app/providers/locale-context';

function Example() {
  const { t } = useLocale();
  return <h2>{t('configure.summary.title')}</h2>;
}
```
With variables:
```tsx
<span>{t('configure.panel.availableIn', { region: 'Warsaw' })}</span>
```

## Adding a new locale
1. Add the locale code to `supportedLocales` in `packages/core/src/i18n/types.ts`.
2. Extend `messages.ts` with a top-level entry for the new code and copy all keys.
3. Update `apps/web/components/LanguageSwitcher.tsx` to show a native name for the new language.
4. (Optional) Add fonts and typography support if required by the script.
5. Verify by launching the app and using `?lang=<code>` in the URL.
6. Run tests: `npm run test:catalog`.

## Lazy-loading & persistence
- The provider lazy-loads the current and default locale from `/api/i18n/[locale]`.
- Preference is stored in `localStorage` and mirrored in the URL param `?lang=xx`.
- The `LanguageSwitcher` prefetches other locales on hover/focus to avoid key flashes.

## Mock catalog strings
- Some items are translated by data ID (e.g., Services):
  - `configure.services.catalog.svc-measure.label` and `.description`
  - `configure.services.catalog.svc-install-waw.*`
  - `configure.services.catalog.svc-rod-basic.*`

## Troubleshooting
- Seeing a raw key like `configure.summary.title` in the UI:
  - Ensure the key exists for both the current locale and the default locale.
  - Confirm `/api/i18n/<locale>` returns the flattened bundle.
  - Check the console for network errors and that `?lang=xx` is a supported code.

## QA checklist
- Switch languages mid-configurator flow; state must be preserved (no reset to corner marking).
- Prices should be formatted with the active locale (currency/code taken from provider/quote).
- Services panel and Summary section show localized copy.
- Reduced-motion users can still use the app without excessive animation.
